{"version":3,"sources":["../../src/pages/home/registration/registration.module.ts","../../src/pages/home/registration/registration.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAyC;AACO;AACE;AAUlD;IAAA;IAAqC,CAAC;IAAzB,sBAAsB;QARlC,uEAAQ,CAAC;YACR,YAAY,EAAE;gBACZ,uEAAgB;aACjB;YACD,OAAO,EAAE;gBACP,sEAAe,CAAC,QAAQ,CAAC,uEAAgB,CAAC;aAC3C;SACF,CAAC;OACW,sBAAsB,CAAG;IAAD,6BAAC;CAAA;AAAH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACZO;AAC0D;AAExB;AAE7C;AAE/B,sDAAsD;AACtD,IAAM,kBAAkB,GAAI,kBAAkB,CAAC;AAE/C;;GAEG;AAMH;IAOE,0BAAmB,OAAsB,EAAS,SAAoB,EAAS,cAA8B,EAAS,QAAkB,EAAU,eAAgC;QAA/J,YAAO,GAAP,OAAO,CAAe;QAAS,cAAS,GAAT,SAAS,CAAW;QAAS,mBAAc,GAAd,cAAc,CAAgB;QAAS,aAAQ,GAAR,QAAQ,CAAU;QAAU,oBAAe,GAAf,eAAe,CAAiB;QACjL,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QAC7C,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;IAChD,CAAC;IAED,yCAAc,GAAd;QACE,OAAO,CAAC,GAAG,CAAC,iCAAiC,CAAC,CAAC;QAC/C,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;IACtD,CAAC;IAEK,kCAAO,GAAb;;;;;4BACkB,qBAAM,gFAAqB,CAAC,aAAa,EAAE;;wBAAxD,UAAU,GAAG,SAA2C;wBAC5D,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC,YAAY,GAAG,GAAG,GAAG,UAAU,CAAC,KAAK,CAAC;wBAEnE,IAAI,CAAC,GAAG,GAAG,qDAAG,CAAC,YAAY,CAAC;;;;;KAE5B;IAED,wCAAa,GAAb;QACC,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;IACnC,CAAC;IAEK,0CAAe,GAArB;;;;;;wBACK,MAAM,GAAG,EAAE,CAAC;wBACf,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;4BAAC,MAAM,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;wBAClE,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;4BAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;wBAE1D,EAAE,CAAC,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;4BAClB,GAAG,GAAG,UAAU,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;4BACzC,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC;gCAC1B,OAAO,EAAE,GAAG;gCACZ,QAAQ,EAAE,IAAI;gCACd,QAAQ,EAAE,aAAa;gCACvB,QAAQ,EAAE,KAAK;6BAEhB,CAAC,CAAC,OAAO,EAAE,CAAC;4BAEb,MAAM,gBAAC,KAAK,EAAC;wBACf,CAAC;wBACD,iCAAiC;wBACjC,qBAAM,gFAAqB,CAAC,mCAAmC,CAAC,qDAAG,CAAC,YAAY,CAAC;;wBADjF,iCAAiC;wBACjC,SAAiF,CAAC;wBAEtE,qBAAM,gFAAqB,CAAC,wCAAwC,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,EAAE,qDAAG,CAAC,YAAY,CAAC;;wBAA3H,KAAK,GAAG,SAAmH;wBAE/H,qBAAM,gFAAqB,CAAC,SAAS,CAAC;gCACpC,4BAA4B,EAAE,KAAK;6BACpC,CAAC;;wBAFF,SAEE,CAAC;wBAEC,YAAY,GAAS,MAAO,CAAC,YAAY,CAAC;wBAE9C,YAAY,CAAC,OAAO,CAAC,SAAS,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;wBAC9C,YAAY,CAAC,OAAO,CAAC,UAAU,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;wBAEhD,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC;4BAC3B,OAAO,EAAE,IAAI,CAAC,OAAO;4BACrB,QAAQ,EAAE,IAAI,CAAC,QAAQ;yBACvB,CAAC,CAAC;;;;;KACJ;IAEO,kCAAO,GAAf,UAAgB,IAAI;QAClB,EAAE,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,CAAC,CAAC;YAAC,MAAM,CAAC,KAAK,CAAC;QAC9C,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;QAC9B,MAAM,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACvC,CAAC;IAtEU,gBAAgB;QAJ5B,wEAAS,CAAC;YACT,QAAQ,EAAE,mBAAmB;WACG;SACjC,CAAC;yBAQkL;OAPvK,gBAAgB,CAwE5B;IAAD,CAAC;AAAA;SAxEY,gBAAgB,e","file":"2.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { RegistrationPage } from './registration';\n\n@NgModule({\n  declarations: [\n    RegistrationPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(RegistrationPage),\n  ],\n})\nexport class RegistrationPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/registration/registration.module.ts","import { Component } from '@angular/core';\nimport {\n\tIonicPage,\n\tNavController,\n\tNavParams,\n\tViewController,\n\tToastController,\n\tPlatform\n} from 'ionic-angular';\n\nimport BackgroundGeolocation from \"../../../cordova-background-geolocation\";\n\nimport ENV from \"../../../ENV\";\n\n// Only allow alpha-numeric usernames with '-' and '_'\nconst USERNAME_VALIDATOR =  /^[a-zA-Z0-9_-]*$/;\n\n/**\n * Generated class for theRegistrationPage page.\n */\n@IonicPage()\n@Component({\n  selector: 'page-registration',\n  templateUrl: 'registration.html',\n})\nexport class RegistrationPage {\n\n\torgname: string;\n\tusername: string;\n\turl: string;\n\tdevicename: string;\n\n  constructor(public navCtrl: NavController, public navParams: NavParams, public viewController: ViewController, public platform: Platform, private toastController: ToastController) {\n  \tthis.orgname = this.navParams.get('orgname');\n  \tthis.username = this.navParams.get('username');\n  }\n\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad RegistrationPage');\n    this.platform.ready().then(this.onReady.bind(this));\n  }\n\n  async onReady() {\n  \tlet deviceInfo = await BackgroundGeolocation.getDeviceInfo();\n  \tthis.devicename = deviceInfo.manufacturer + ' ' + deviceInfo.model;\n\n  \tthis.url = ENV.TRACKER_HOST;\n\n  }\n\n  onClickCancel() {\n  \tthis.viewController.dismiss(null);\n  }\n\n  async onClickRegister() {\n  \tlet errors = [];\n    if (!this.isValid(this.orgname)) errors.push('Organization name');\n    if (!this.isValid(this.username)) errors.push('Username');\n\n    if (errors.length > 0) {\n      let msg = \"Invalid \" + errors.join(', ');\n      this.toastController.create({\n        message: msg,\n        duration: 3000,\n        cssClass: 'toast-error',\n        position: 'top'\n\n      }).present();\n\n      return false;\n    }\n    // Destroy existing cached token.\n    await BackgroundGeolocation.destroyTransistorAuthorizationToken(ENV.TRACKER_HOST);\n    // Register device with tracker.transistorsoft.com to receive a JSON Web Token (JWT).\n    let token = await BackgroundGeolocation.findOrCreateTransistorAuthorizationToken(this.orgname, this.username, ENV.TRACKER_HOST);\n\n    await BackgroundGeolocation.setConfig({\n      transistorAuthorizationToken: token\n    });\n\n    let localStorage = (<any>window).localStorage;\n\n    localStorage.setItem('orgname', this.orgname);\n    localStorage.setItem('username', this.username);\n\n    this.viewController.dismiss({\n    \torgname: this.orgname,\n    \tusername: this.username\n    });\n  }\n\n  private isValid(name) {\n    if (!name || (name.length == 0)) return false;\n    name = name.replace(/s+/, '');\n    return USERNAME_VALIDATOR.test(name);\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/registration/registration.ts"],"sourceRoot":""}